<app-page-grid>
  <div nz-row nzGutter="16">
    <div nz-col nzSpan="17">
      <nz-table
        #rowSelectionTable
        [nzData]="cartObjects$ | async"
        [nzShowPagination]="false"
        [nzFrontPagination]="false"
      >
        <thead>
          <tr>
            <th
              *ngFor="let column of listOfColumn"
              [nzWidth]="column.width"
              [nzSortOrder]="column.sortOrder"
              [ngClass]="column.class"
              [nzSortDirections]="column.sortDirections"
              (nzSortOrderChange)="onSort($event, column)"
            >
              {{ column.name }}
            </th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let item of rowSelectionTable.data">
            <tr>
              <td>
                <img
                  nz-image
                  width="100px"
                  height="100px"
                  [nzSrc]="item.photo"
                  alt=""
                />
              </td>
              <td>
                <h4 class="font-weight-bold mb-0">{{ item.name }}</h4>
                <span>
                  <nz-list-item-meta-description
                    *ngFor="let ele of item.specifications"
                  >
                    <div *ngFor="let obj of ele | keyvalue">
                      <span class="d-flex"
                        >{{ obj.key.toString() | titlecase }}: &nbsp;
                        <p class="mb-0">{{ obj.value }}</p></span
                      >
                    </div>
                  </nz-list-item-meta-description>
                </span>
                <a (click)="goToProduct(item.id)">Edit</a>
              </td>
              <td>
                <span class="font-weight-bold"
                  >{{ item.price | number }}VNĐ</span
                >
              </td>
              <td>
                <div class="d-flex align-end">
                  <nz-input-number
                    nzBorderless
                    [nzMax]="10"
                    [nzMin]="1"
                    [(ngModel)]="item.quantity"
                    (ngModelChange)="onChangeQuantity(item.id, $event)"
                  ></nz-input-number>
                </div>
              </td>
              <td>
                <span
                  ><app-button-icon
                    class="ml-2"
                    toolTipTitle="Delete"
                    iconClass="fa-regular fa-trash-can"
                    placement="top"
                    nz-popconfirm
                    nzPopconfirmTitle="Are you sure delete this product?"
                    nzPopconfirmPlacement="top"
                    (nzOnConfirm)="deleteRecord(item.id)"
                  ></app-button-icon
                ></span>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </nz-table>

      <nz-card nzTitle="Information" class="mt-4">
        <form nz-form [formGroup]="infoForm">
          <div nz-row nzGutter="24">
            <div nz-col nzSpan="12" class="pr-1">
              <nz-form-item>
                <nz-form-control
                  [nzSpan]="24"
                  nzErrorTip="First name is required"
                >
                  <input
                    nz-input
                    name="firstName"
                    type="text"
                    id="firstName"
                    formControlName="firstName"
                    placeholder="First name"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>

            <div nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-control
                  [nzSpan]="24"
                  nzErrorTip="Last name is required"
                >
                  <input
                    nz-input
                    name="lastName"
                    type="text"
                    id="lastName"
                    formControlName="lastName"
                    placeholder="Last name"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <div nz-row nzGutter="24">
            <div nz-col nzSpan="12" class="pr-1">
              <nz-form-item>
                <nz-form-control [nzSpan]="24" nzErrorTip="Email is required">
                  <input
                    nz-input
                    name="email"
                    type="text"
                    id="email"
                    formControlName="email"
                    placeholder="Email"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>

            <div nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-control [nzSpan]="24" nzErrorTip="Phone is required">
                  <input
                    nz-input
                    name="phone"
                    type="text"
                    id="phone"
                    formControlName="phone"
                    placeholder="Phone"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <div nz-row nzGutter="16">
            <div nz-col nzSpan="24">
              <nz-radio-group
                formControlName="formal"
                (ngModelChange)="onChangeFormal($event)"
              >
                <label nz-radio nzValue="store">At store</label>
                <label nz-radio nzValue="delivery">Delivery</label>
              </nz-radio-group>
            </div>
          </div>

          <ng-container
            *ngIf="infoForm.value.formal === 'store'; else delivery"
          >
            <div nz-row nzGutter="16" class="mt-3">
              <div nz-col nzSpan="24">
                <nz-select formControlName="shop" class="w-100" nzPlaceHolder="Shop">
                  <nz-option
                    *ngFor="let item of listShop"
                    [nzValue]="item.id"
                    [nzLabel]="item.name"
                  ></nz-option>
                </nz-select>
              </div>
            </div>
          </ng-container>

          <ng-template #delivery>
            <div nz-row nzGutter="16" class="mt-3">
              <div nz-col nzSpan="24">
                <nz-form-item>
                  <nz-form-control
                    [nzSpan]="20"
                    nzErrorTip="Please input your id address!"
                  >
                    <input
                      nz-input
                      id="address"
                      formControlName="address"
                      placeholder="Address"
                    />
                  </nz-form-control>
                </nz-form-item>
              </div>
            </div>
          </ng-template>
        </form>
      </nz-card>
    </div>
    <div nz-col nzSpan="7">
      <nz-card nzTitle="Sumary" >
        <div class="align-child-space-between">
          <span
            >Subtotal &nbsp;
            <i
              class="fa-regular fa-circle-question"
              nz-tooltip
              nzTooltipTitle="The subtotal reflects the total price of your order, including taxes, before any applicable discounts. It does not include delivery costs and international transaction fees."
            ></i
          ></span>
          <p>{{ subTotalCost | number }}VNĐ</p>
        </div>
        <div class="align-child-space-between">
          <span>Estimated Delivery & Handling</span>
          <p>{{ deliveryCost | number }}VNĐ</p>
        </div>
        <nz-divider class="mt-0 mb-2"></nz-divider>
        <div class="align-child-space-between">
          <span>Total</span>
          <p>{{ subTotalCost + deliveryCost | number }}VNĐ</p>
        </div>
      </nz-card>
      <nz-card nzTitle="Payment">
        <nz-radio-group formControlName="payment">
          <label *ngFor="let item of listPayment" nz-radio-button [nzValue]="item.name">
            
          </label>
        </nz-radio-group>
      </nz-card>
      <button
        nz-button
        nzType="primary"
        class="w-100 h-50px mt-3"
        nzSize="large"
        nzShape="round"
        (click)="onCheckOut()"
      >
        Check out
      </button>
    </div>
  </div>
</app-page-grid>
